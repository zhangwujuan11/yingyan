{"ast":null,"code":"import \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.regexp.test.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport Popupp from '@/components/Popupp.vue';\nimport Administrtab from '@/components/Administrtab.vue';\nimport http from '@/common/api/request.js';\nimport { delroot, journal } from '@/common/api/adminCenter';\nimport Foot from '@/components/Foot.vue';\nimport { Toast, MessageBox } from 'mint-ui'; // import BetterScroll from '@better-scroll/core'\n\nexport default {\n  inject: [\"reload\"],\n  data: function data() {\n    return {\n      startX: 0,\n      //滑动开始\n      endX: 0,\n      //滑动结束\n      popupVisible: false,\n      //添加设备表单是否显示\n      updata: false,\n      //设备是否添加成功\n      rootForm: {\n        'device_ip': '',\n        //设备ip\n        // 'device_id':'',//设备\n        'device_account': '',\n        //设备账号\n        'device_password': '',\n        //设备密码\n        'org_id': Number(JSON.parse(localStorage.getItem('urlUserinfor')).orgId),\n        //机构id\n        'push_url': '',\n        //推流直播地址\n        'device_type': 1,\n        //设备类型\n        'state': 1,\n        //状态\n        'device_name': '',\n        //设备名称\n        \"scope\": ''\n      },\n      device_type_name: [],\n      //设备类型名称\n      cameraList: [],\n      rules: {\n        device_name: {\n          rule: /^.+$/,\n          msg: \"设备名称不能为空\"\n        },\n        device_ip: {\n          rule: /^((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])$/,\n          msg: \"ip地址输入错误\"\n        },\n        // device_id:{\n        // \trule:/^.+$/,\n        // \tmsg:\"设备id不能为空\"\n        // },\n        // device_account:{\n        // \trule:/^.+$/,\n        // \tmsg:\"设备账号不能为空\"\n        // },\n        device_password: {\n          rule: /^.+$/,\n          msg: \"设备密码不能为空\"\n        },\n        device_type: {\n          rule: /^.+$/,\n          msg: \"设备类型不能为空\"\n        },\n        device_id: {\n          rule: /^.+$/,\n          msg: \"设备id不能为空\"\n        }\n      }\n    };\n  },\n  components: {\n    Popupp: Popupp,\n    Administrtab: Administrtab,\n    Foot: Foot\n  },\n  created: function created() {\n    var _this = this;\n\n    // 获取设备列表\n    http.$axios({\n      url: 'device/getDevices',\n      method: \"GET\",\n      params: {\n        \"org_id\": this.$store.state.userorgid\n      }\n    }).then(function (res) {\n      _this.cameraList = res.data.data;\n    });\n    this.$nextTick(function () {\n      // 获取设备类型名称\n      http.$axios({\n        url: 'https://1to2to3.cn/rds2/service/query',\n        data: {\n          \"auth\": 2,\n          \"project\": \"eagle_eye\",\n          \"table\": \"sys_device_type\",\n          \"conditions\": {\n            \"fields\": [\"device_type_name\"],\n            \"query\": {}\n          }\n        }\n      }).then(function (res) {\n        _this.device_type_name = res.data.data; // new BetterScroll('.wrapper', {\n        //    movable: true,\n        //    zoom: true,\n        // \tprobeType:2,\n        // \tclick:true\n        //  })\n      });\n    });\n  },\n  methods: {\n    // 添加设备表单\n    formRec: function formRec() {\n      this.popupVisible = true;\n    },\n    // 保存添加设备信息\n    infPost: function infPost() {\n      var _this2 = this;\n\n      if (!this.validate('device_name')) return;\n      if (!this.validate('device_ip')) return;\n      if (!this.validate('device_id')) return; // if( !this.validate('device_account') ) return;\n\n      if (!this.validate('device_password')) return;\n      if (!this.validate('device_type')) return;\n      this.rootForm.device_id = Number(this.rootForm.device_id);\n      http.$axios({\n        url: '/device',\n        data: this.rootForm\n      }).then(function (res) {\n        Toast(res.data.result);\n        _this2.popupVisible = false;\n        _this2.updata = true;\n        journal({\n          \"appName\": \"eagle\",\n          \"methodName\": \"添加设备\",\n          \"methodRemark\": \"添加了\" + _this2.rootForm.device_name + \"设备\",\n          \"optReqParam\": \"\",\n          \"optResInfo\": res.data.result,\n          \"reqUrl\": \"\"\n        }).then(function (res) {\n          console.log(res);\n        });\n\n        _this2.reload();\n      }).catch(function () {\n        Toast('添加失败，请重试');\n      });\n    },\n    //验证信息提示\n    validate: function validate(key) {\n      var bool = true;\n\n      if (!this.rules[key].rule.test(this.rootForm[key])) {\n        //提示信息\n        Toast(this.rules[key].msg);\n        bool = false;\n        return false;\n      }\n\n      return bool;\n    },\n    // 关闭蒙尘\n    changVisible: function changVisible() {\n      this.popupVisible = false;\n    },\n    // 向左滑动出现删除按钮时，点击商品信息区域取消删除\n    oneself: function oneself() {\n      if (this.checkSlide()) {\n        this.restSlide();\n      }\n    },\n    //滑动开始\n    touchStart: function touchStart(e) {\n      // 记录初始位置\n      this.startX = e.touches[0].clientX;\n    },\n    //滑动结束\n    touchEnd: function touchEnd(e) {\n      // 当前滑动的父级元素\n      var parentElement = e.currentTarget.parentElement; // 记录结束位置\n\n      this.endX = e.changedTouches[0].clientX; // 左滑大于30距离删除出现\n\n      if (parentElement.dataset.type == 0 && this.startX - this.endX > 30) {\n        this.restSlide();\n        parentElement.dataset.type = 1;\n      } // 右滑\n\n\n      if (parentElement.dataset.type == 1 && this.startX - this.endX < -30) {\n        this.restSlide();\n        parentElement.dataset.type = 0;\n      }\n\n      this.startX = 0;\n      this.endX = 0;\n    },\n    //判断当前是否有滑块处于滑动状态\n    checkSlide: function checkSlide() {\n      var listItems = document.querySelectorAll(\".li_vessel\");\n\n      for (var i = 0; i < listItems.length; i++) {\n        if (listItems[i].dataset.type == 1) {\n          return true;\n        }\n      }\n\n      return false;\n    },\n    //复位滑动状态\n    restSlide: function restSlide() {\n      var listItems = document.querySelectorAll(\".li_vessel\"); // 复位\n\n      for (var i = 0; i < listItems.length; i++) {\n        listItems[i].dataset.type = 0;\n      }\n    },\n    //删除数据信息\n    remove: function remove(e) {\n      var _this3 = this;\n\n      MessageBox.confirm('确定删除' + e.DeviceName + '设备?').then(function (action) {\n        delroot(e).then(function (res) {\n          Toast(\"设备删除成功\");\n\n          _this3.reload();\n        }).catch(function () {\n          Toast(\"设备删除失败，请稍后重试\");\n        });\n      });\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module"}