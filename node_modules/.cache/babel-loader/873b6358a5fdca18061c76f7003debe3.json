{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport Serch from '@/components/home/Serch.vue';\nimport Camera from '@/components/home/Camera.vue';\nimport Abnormal from '@/components/home/Abnormal.vue';\nimport Foot from '@/components/Foot.vue';\nimport '@/assets/prop.css';\nimport http from '@/common/api/request.js';\nimport { ChatClient } from \"@qians/quake_ws_client-wasm\"; //插件\n\nimport BScroll from '@better-scroll/core';\nexport default {\n  name: 'HomeView',\n  data: function data() {\n    return {\n      newsList: [//公告数据\n      {\n        id: 1,\n        con: \"微数场新功能即将上线，敬请期待~\"\n      }],\n      cameraPopup: false,\n      //监视器蒙尘状态\n      addshow: false,\n      pop1: false,\n      //serch的pop们\n      pop2: false,\n      pop3: false,\n      pop4: false,\n      cameraList: [],\n      device_type_name: [],\n      //设备类型名称\n      camlist: false,\n      //设备列表是否更新\n      ExceptionList: []\n    };\n  },\n  components: {\n    Serch: Serch,\n    Camera: Camera,\n    Foot: Foot,\n    Abnormal: Abnormal\n  },\n  methods: {\n    // //摄像头蒙尘状态\n    change: function change(res) {\n      this.cameraPopup = res;\n    },\n    // 头部加号状态\n    addnewshow: function addnewshow(rq) {\n      this.addshow = rq;\n    },\n    // addList\n    closeTab: function closeTab() {\n      if (this.addshow) {\n        this.addshow = false;\n        this.$refs.child.showTab(this.addshow);\n      }\n    },\n    //serch的pop们\n    serpop1: function serpop1(res) {\n      this.pop1 = res;\n    },\n    serpop2: function serpop2(res) {\n      this.pop2 = res;\n    },\n    serpop3: function serpop3(res) {\n      this.pop3 = res;\n    },\n    serpop4: function serpop4(res) {\n      this.pop4 = res;\n    },\n    // 设备列表是否更新\n    updata: function updata(res) {\n      this.camlist = res;\n    },\n    // 连接wasm\n    chat: function chat() {\n      console.log(\"[Views: HomeView.vue]wait for init client\"); //FIXME: change k32212 to username(token)\n\n      ChatClient.init(\"k32212\", 'levitas.quakeai.tech:31033', 'eye_h5', true);\n      this.ChatClient = ChatClient;\n      console.log(\"[Views: HomeView.vue]chat client has been inited: \", this.ChatClient);\n    }\n  },\n  created: function created() {\n    var _this = this;\n\n    this.chat();\n    this.$store.commit('USER_ORG_ID', this.$route.query.UserOrgID);\n    this.$nextTick(function () {\n      // 获取设备列表\n      http.$axios({\n        url: 'device/getDevices',\n        method: \"GET\",\n        params: {\n          \"org_id\": _this.$store.state.userorgid\n        }\n      }).then(function (res) {\n        // console.log(res.data)\n        _this.cameraList = res.data.data;\n      }), // 获取设备类型名称\n      http.$axios({\n        url: 'https://1to2to3.cn/rds2/service/query',\n        data: {\n          \"auth\": 2,\n          \"project\": \"eagle_eye\",\n          \"table\": \"sys_device_type\",\n          \"conditions\": {\n            \"fields\": [\"device_type_name\"],\n            \"query\": {}\n          }\n        }\n      }).then(function (res) {\n        // console.log(res.data)\n        _this.device_type_name = res.data.data;\n      }), // 获取工控服务列表\n      http.$axios({\n        url: 'job/getJobs',\n        method: 'GET',\n        params: {\n          \"org_id\": _this.$store.state.userorgid\n        }\n      }).then(function (res) {\n        _this.ExceptionList = res.data.data;\n      }).catch(function () {\n        _this.ExceptionList = [];\n      });\n    });\n  },\n  // mounted() {\n  //  this.$nextTick(()=>{\n  //   console.log(this.$store.state.userorgid)\n  //  })\n  // },\n  watch: {\n    camlist: function camlist(val) {\n      var _this2 = this;\n\n      if (val == true) {\n        // 获取设备列表\n        http.$axios({\n          url: 'device/getDevices',\n          method: \"GET\",\n          params: {\n            \"org_id\": this.$store.state.userorgid //机构ID\n            //\"page\":1,\n            //\"pageSize\":10,\n            //     \"device_type\":1 设备类型\n\n          }\n        }).then(function (res) {\n          // console.log(res.data.data)\n          _this2.cameraList = res.data.data;\n          _this2.camlist = false;\n        });\n      }\n    },\n    ExceptionList: function ExceptionList() {\n      this.$nextTick(function () {\n        var bs = new BScroll('.wrapper', {\n          movable: true,\n          zoom: true,\n          probeType: 2,\n          click: true\n        });\n      });\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module"}